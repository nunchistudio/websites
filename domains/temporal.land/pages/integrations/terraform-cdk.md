---
location: "/integrations/terraform/documentation/terraform-cdk.md"
title: "Terraform: Deploy infrastructure from Terraform CDK"

goref:
  - "integrations/terraform"
---

# {% $markdoc.frontmatter.title %}

Terraform Cloud Development Kit (CDK) was developed to let you manage
Infrastructure as Code with your preferred programming language.

## Workflows and activities

{% callout title="Integration name" iconType="accessibility" %}
  `custom` is the name of the integration set in `terraform.Config`. See example
  below for details.
{% /callout %}

{% accordion title="Apply provisions" %}
  By using this workflow, you can deploy infrastructure resources returned by
  Terraform CDK in a workflow.

  - Workflow name: `custom.DeployFromCDK`
  - Input type: [`terraform.InputDeployFromCDK`](https://pkg.go.dev/go.temporal.land/integrations/terraform#InputDeployFromCDK)
  - Output type: [`terraform.OutputDeployFromCDK`](https://pkg.go.dev/go.temporal.land/integrations/terraform#OutputDeployFromCDK)
  - Activities names:
    - `custom.DeployFromCDK.Validation` (local)
    - Within a session:
      - `custom.DeployFromCDK.WriteFile`
      - `custom.DeployFromCDK.Init`
      - `custom.DeployFromCDK.Apply`
      - `custom.DeployFromCDK.Cleanup`
{% /accordion %}

## End-to-end example

### Worker

Before being able to consume the integration, it must first be registered in a
Temporal worker:

```go
package main

import (
  "context"

  "go.temporal.io/sdk/client"
  "go.temporal.io/sdk/worker"
  "go.temporal.land/integrations/terraform"
)

func main() {
  ctx := context.Background()

  // Create the Temporal client, as stated in the Temporal documentation.
  c, _ := client.NewClient(client.Options{})
  defer c.Close()
  
  // Create the Temporal worker, as stated in the Temporal documentation.
  // Sessions must be enabled on the worker. Otherwise workflows will fail. More
  // info at: https://docs.temporal.io/go/how-to-create-a-worker-session-in-go
  w := worker.New(c, "queue", worker.Options{
    EnableSessionWorker: true,
  })

  // Create a new instance of the integration. You can create different instances
  // of the same integration by providing a custom name in the Config.
  inte, _ := terraform.New(ctx, terraform.Config{
    Integration: integration.Config{
      Name: "custom",
    },
    Version:     "1.2.6",
    PathToFiles: "/.tmp/workflows",
  })

  // Make sure to release the resources consumed by the integration when process
  // is done.
  defer inte.Close()

  // Register the workflows and activites provided by the integration, and
  // initialize it.
  _ = inte.Register(w)
  _ = inte.Init()

  // Start the worker!
  _ = w.Run(worker.InterruptCh())
}
```

### Client

This example is written with the Temporal and Terraform Go SDKs, but works as
well for any supported SDKs such as TypeScript, Python, Java, or PHP. All you
need is to execute the desired workflow from an application using the Temporal
and Terraform client of your choice.

```go
package main

import (
  "context"
  "os"

  "go.temporal.io/sdk/client"
  "go.temporal.land/integrations/terraform"
  "go.temporal.land/toolkit/event"

  "github.com/hashicorp/terraform-cdk-go/cdktf"
)

func main() {
  ctx := context.Background()

  // Create the Temporal client, as stated in the Temporal documentation.
  c, _ := client.NewClient(client.Options{})
  defer c.Close()

  // Create a new Terraform CDK project.
  project := cdktf.NewApp(&cdktf.AppOptions{})

  // Create the Terraform stack you wish to deploy.
  // ...

  // Write the Terraform files to the output directory. By default it's located
  // at: "./cdktf.out".
  project.Synth()

  // Read the content of the files generated by Terraform, so we can pass these
  // to the workflow later.
  provisions, _ := os.ReadFile("./cdktf.out/stacks/<stack>/cdk.tf.json")
  manifestRoot, _ := os.ReadFile("./cdktf.json")
  manifestStacks, _ := os.ReadFile("./cdktf.out/manifest.json")

  // Define the workflow options, as stated in the Temporal documentation.
  opts := client.StartWorkflowOptions{
    TaskQueue: "queue",
  }

  // Execute the workflow previously registered in the worker.
  _, _ = c.ExecuteWorkflow(ctx, opts, "custom.DeployFromCDK", terraform.InputDeployFromCDK{
    Context:        event.Context{},
    Provisions:     provisions,
    ManifestRoot:   manifestRoot,
    ManifestStacks: manifestStacks,
  })
}
```
